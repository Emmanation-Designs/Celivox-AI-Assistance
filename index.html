<!Doctype html>  <html lang="en">  
<head>  
<meta charset="utf-8" />  
<meta name="viewport" content="width=device-width,initial-scale=1" />  
<title>Celivox - Text Chat</title>  
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">  
<!-- Firebase App -->  
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>  <!-- Firebase Auth -->  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>  <!-- Firebase Realtime Database -->  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>  <!-- Firebase Storage (optional for images later) -->  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>  <style>  
  :root{  
    --bg-light-start:#f0f7ff; --bg-light-end:#dbeafe;  
    --bg-dark-start:#071123; --bg-dark-end:#071a2b;  
    --accent:#2563eb;  
  }  
  html,body{height:100%;margin:0;font-family:Arial, sans-serif;}  
  body{  
    display:flex;flex-direction:column;  
    background:linear-gradient(135deg,var(--bg-light-start),var(--bg-light-end));  
    color:#07203a;transition:background .4s ease,color .3s ease;  
  }  
  body.dark{background:linear-gradient(135deg,var(--bg-dark-start),var(--bg-dark-end)); color:#dbeafe;}  
  
  /* Auth Section */  
  #authSection{flex:1;display:flex;align-items:center;justify-content:center;}  
  #authBox{background:white;padding:30px;border-radius:12px;width:350px;text-align:center;box-shadow:0 4px 20px rgba(0,0,0,0.1);}  
  #authBox input{width:90%;padding:12px;margin:10px 0;border:1px solid #ccc;border-radius:8px;font-size:14px;}  
  #authBox button{background:#2563eb;color:#fff;border:none;padding:12px 20px;margin:10px 5px;border-radius:8px;cursor:pointer;font-weight:bold;}  
  #authBox button:hover{background:#1e3a8a;}  
  #authMessage{margin-top:10px;font-weight:bold;font-size:14px;color:red;}  
  
  /* Assistant Page */  
  #assistantPage{flex:1;display:none;flex-direction:column;height:100%;}  
  .ai-title{font-size:2rem;font-weight:900;text-align:center;  
    background:linear-gradient(90deg,#2563eb,#9333ea);  
    -webkit-background-clip:text;-webkit-text-fill-color:transparent;  
    margin:20px 0;  
  }  
  .chat-container{flex:1;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:12px;position:relative;}  
  .bubble{max-width:70%;padding:12px 16px;border-radius:18px;font-size:15px;line-height:1.4;word-wrap:break-word;position:relative;cursor:pointer;}  
  .user-bubble{align-self:flex-end;background:#2563eb;color:white;border-bottom-right-radius:4px;}  
  .ai-bubble{align-self:flex-start;background:#e5e7eb;color:#111;border-bottom-left-radius:4px;}  
  body.dark .ai-bubble{background:#0b1320;color:#cfe6ff;}  
  body.dark .user-bubble{background:#1e40af;}  
  .ai-bubble img{max-width:250px;border-radius:12px;margin-top:6px;}  
  
  .input-area{display:flex;padding:12px;background:white;border-top:1px solid #ddd;}  
  .input-area input{flex:1;padding:10px 14px;border-radius:20px;border:1px solid #bbb;font-size:15px;}  
  .input-area button{margin-left:10px;padding:10px 18px;border-radius:20px;border:none;background:#2563eb;color:#fff;cursor:pointer;font-weight:bold;}  
  
  /* Sidebar */  
  #menuToggle{position:fixed;top:15px;left:15px;z-index:1001;cursor:pointer;}  
  #menuToggle div{width:30px;height:4px;background-color:var(--accent);margin:6px 0;}  
  #sidebarMenu{height:100%;width:0;position:fixed;top:0;left:0;background:linear-gradient(180deg,var(--bg-light-start),var(--bg-light-end));overflow-x:hidden;transition:width 0.3s;padding-top:60px;z-index:1000;}  
  body.dark #sidebarMenu{background:linear-gradient(180deg,var(--bg-dark-start),var(--bg-dark-end));}  
  #sidebarMenu a, #sidebarMenu button, #sidebarMenu input{padding:12px 30px;text-decoration:none;font-size:16px;color:var(--accent);display:flex;align-items:center;gap:12px;font-weight:600;border:none;background:none;width:100%;text-align:left;}  
  #sidebarMenu a:hover, #sidebarMenu button:hover{background-color:rgba(37,99,235,0.15);color:#fff;}  
  #sidebarClose{position:absolute;top:15px;right:20px;font-size:30px;cursor:pointer;color:var(--accent);}  
  #searchBox{width:80%;margin:10px auto;padding:10px;border-radius:8px;border:1px solid #bbb;font-size:14px;}  
  
  /* Bubble actions menu */  
  .bubble-menu{  
    position:absolute;  
    top:-35px;  
    right:0;  
    display:flex;  
    gap:8px;  
    background:rgba(0,0,0,0.7);  
    padding:5px 8px;  
    border-radius:6px;  
    color:white;  
    font-size:14px;  
    z-index:10;  
  }  
  .bubble-menu i{cursor:pointer;}  
</style>  </head>  
<body>  <!-- Auth Section -->  <div id="authSection">  
 <div id="authBox">  
  <h2>Register / Login</h2>    <!-- Email Input -->    <input type="email" id="regEmail" placeholder="Enter your email" required>    <!-- Password Input with Toggle -->    <div style="position:relative; width:90%; margin:10px auto;">  
    <input type="password" id="regPassword" placeholder="Enter your password" required style="padding-right:40px;">  
    <i id="togglePassword" class="fa-solid fa-eye"   
       style="position:absolute; top:50%; right:10px; transform:translateY(-50%); cursor:pointer; color:#555;"></i>  
  </div>    <div>  
    <button onclick="register()">Register</button>  
    <button onclick="login()">Login</button>  
  </div>    <p id="authMessage"></p>  
</div>  
</div>  <!-- Assistant Page -->  <div id="assistantPage">  
  <div id="menuToggle" onclick="openMenu()"><div></div><div></div><div></div></div>  
  <div id="sidebarMenu">  
    <span id="sidebarClose" onclick="closeMenu()">&times;</span>  
    <input type="text" id="searchBox" placeholder="Search past chats..." oninput="searchMemory(this.value)">  
<a href="https://api.whatsapp.com/send?phone=2348081682884&text=Hello%20I%20need%20support" target="_blank">
  WhatsApp Support
</a>
    <button id="aboutMenu">‚ÑπÔ∏è About</button>  
    <a href="#" onclick="logout()"><i class="fa-solid fa-arrow-right-from-bracket"></i> Logout</a>  
    <button onclick="clearMemory()"><i class="fa-solid fa-trash"></i> Clear Memory</button>  
    <button onclick="toggleTheme()"><i class="fa-solid fa-circle-half-stroke"></i> Toggle Theme</button>  
    <!-- Sidebar below your current buttons -->  
<!-- Sidebar below your current buttons -->  
<div style="margin-top:20px; padding: 0 12px;">  
  <button onclick="startNewTopic()"   
          style="margin-bottom:10px; width:100%; padding:8px; border:none; border-radius:6px; background:#2563eb; color:white; cursor:pointer;">  
    + New Chat  
  </button>  
  <strong>Past Chats</strong>  
  <div id="chatHistoryContainer" style="max-height:300px; overflow-y:auto; margin-top:10px;"></div>  
</div>  
  </div>    <div class="ai-title">CELIVOX</div>  
  <div class="chat-container" id="chatContainer"></div>  
  <div class="input-area">  
    <input type="text" id="userInput" placeholder="Type your message...">  
    <button onclick="sendMessage()">Send</button>  
  </div>  
</div>  
<!-- About Page Container -->  
<div id="aboutPage" class="about-page hidden">  
  <div class="about-header">  
    <button id="aboutBack">&larr; Back</button>  
    <h1>About Celivox</h1>  
  </div>    <div class="about-body">  
    <img src="ai.png" alt="Celivox Logo" class="about-logo">  
    <h2>Celivox AI Assistant</h2>  
    <p>Celivox is a web-based AI assistant combining <br> text and voice interaction, designed for <br> seamless productivity and communication.</p>  <h3>Developer</h3>  
<p>Emmanuel Nwaije <br> (Emmanation Designs)</p>  

<h3>Version</h3>  
<p>1.0</p>  

<h3>Features</h3>  
<ul>  
  <li>Text interaction</li>  
  <li>Privacy Assured</li>  
  <li>Real life answers</li>  
  <li>voice interaction, image generation will soon be available</li>  
</ul>

  </div>  
</div>  <style>  
  .hidden { display: none; }  
  
  .about-page {  
    position: fixed;  
    top: 0;  
    left: 0;  
    width: 100%;  
    height: 100%;  
    background-color: #f4ecd8; /* sand color */  
    color: #333;  
    z-index: 999;  
    overflow-y: auto;  
    font-family: sans-serif;  
    padding: 20px;  
  }  
  
  .about-header {  
    display: flex;  
    align-items: center;  
    gap: 16px;  
    margin-bottom: 20px;  
  }  
  
  #aboutBack {  
    padding: 6px 12px;  
    font-size: 16px;  
    cursor: pointer;  
    border-radius: 6px;  
    border: none;  
    background-color: #d4b483; /* darker sand button */  
    color: #fff;  
  }  
  
  .about-body {  
    text-align: center;  
    max-width: 600px;  
    margin: 0 auto;  
  }  
  
  .about-logo {  
    width: 100px;  
    margin-bottom: 12px;  
  }  
  
  h2 {  
    margin: 10px 0;  
  }  
  
  ul {  
    text-align: left;  
    margin: 10px auto;  
    padding-left: 20px;  
  }  
  
  li {  
    margin-bottom: 6px;  
  }  
</style>  <script>  
    // ---------- FIREBASE CONFIG ----------  
const firebaseConfig = {  
  apiKey: "AIzaSyDx3TouE9Y5sWETw1givSnYf09B88QsRxU",  
  authDomain: "celivox-ai.firebaseapp.com",  
  databaseURL: "https://celivox-ai-default-rtdb.firebaseio.com",  
  projectId: "celivox-ai",  
  storageBucket: "celivox-ai.appspot.com",  
  messagingSenderId: "583893605040",  
  appId: "1:583893605040:web:44b0c590132062c55cb975"  
};  
  const aboutPage = document.getElementById('aboutPage');  
  const aboutMenuBtn = document.getElementById('aboutMenu'); // your sidebar menu  
  const aboutBackBtn = document.getElementById('aboutBack');  
  
  // Open About page  
  aboutMenuBtn.addEventListener('click', () => {  
    aboutPage.classList.remove('hidden');  
  });  
  
  // Back to main page  
  aboutBackBtn.addEventListener('click', () => {  
    aboutPage.classList.add('hidden');  
  });  
</script>  <script>  
  
  
// Initialize Firebase  
firebase.initializeApp(firebaseConfig);  
  
// Firebase services  
const auth = firebase.auth();  
const database = firebase.database();  
const storage = firebase.storage(); // optional for images  
  const authSection=document.getElementById('authSection');  
  const assistantPage=document.getElementById('assistantPage');  
  const chatContainer=document.getElementById('chatContainer');  
  const userInput=document.getElementById('userInput');  
  const msg=document.getElementById('authMessage');  
  
  const birthDate = new Date("2008-03-18");  
  function getAge() {  
    const today = new Date();  
    let age = today.getFullYear() - birthDate.getFullYear();  
    const m = today.getMonth() - birthDate.getMonth();  
    if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) age--;  
    return age;  
  }  
  function get18thBirthday() {  
    const eighteenth = new Date(birthDate);  
    eighteenth.setFullYear(eighteenth.getFullYear() + 18);  
    return eighteenth.toDateString();  
  }  
  
  const BASE_IDENTITY = `Celivox is an AI assistant developed by Emmanuel Nwaije Ikemefuna (Emmanation Designs), a ${getAge()}-year-old software developer from Nigeria. Emmanuel created Celivox to assist users with web, AI, and coding queries. Celivox was brought to existence on 10th September 2025.\n`;  
  
  function showAssistantPage(){  
    authSection.style.display='none';  
    assistantPage.style.display='flex';  
    restoreConversation();  
  }  
  
  // -------- Auth --------  
  // REGISTER  
// REGISTER  
function register() {  
  const email = document.getElementById("regEmail").value.trim();  
  const password = document.getElementById("regPassword").value;  
  
  if (!email || !password) {  
    msg.innerText = "‚ùå Please enter email and password!";  
    return;  
  }  
  
  auth.createUserWithEmailAndPassword(email, password)  
    .then(() => {  
      showAssistantPage();  
    })  
    .catch(err => {  
      msg.innerText = "‚ùå " + err.message;  
    });  
}  
  
// LOGIN  
function login() {  
  const email = document.getElementById("regEmail").value.trim();  
  const password = document.getElementById("regPassword").value;  
  
  if (!email || !password) {  
    msg.innerText = "‚ùå Please enter email and password!";  
    return;  
  }  
  
  auth.signInWithEmailAndPassword(email, password)  
    .then(() => {  
      showAssistantPage();  
    })  
    .catch(err => {  
      msg.innerText = "‚ùå " + err.message;  
    });  
}  
// Toggle password visibility  
const togglePassword = document.getElementById("togglePassword");  
const passwordInput = document.getElementById("regPassword");  
  
togglePassword.addEventListener("click", () => {  
  const type = passwordInput.type === "password" ? "text" : "password";  
  passwordInput.type = type;  
  togglePassword.className = type === "password" ? "fa-solid fa-eye" : "fa-solid fa-eye-slash";  
});  
  
// LOGOUT  
function logout() {  
  auth.signOut().then(() => {  
    authSection.style.display = 'flex';  
    assistantPage.style.display = 'none';  
  });  
}  
  
// Check if user is logged in on page load  
auth.onAuthStateChanged(user => {  
  if (user) showAssistantPage();  
});  
  
  // -------- Sidebar --------  
  function openMenu(){document.getElementById("sidebarMenu").style.width="260px";}  
  function closeMenu(){document.getElementById("sidebarMenu").style.width="0";}  
  function toggleTheme(){  
    document.body.classList.toggle("dark");  
    localStorage.setItem("theme",document.body.classList.contains("dark")?"dark":"light");  
  }  
  
  // -------- Chat Bubbles with Actions --------  
  function appendBubble(content,isUser,isImage=false){  
    const div=document.createElement("div");  
    div.className="bubble "+(isUser?"user-bubble":"ai-bubble");  
    div.dataset.user=isUser?"true":"false";  
  
    if(isImage){  
      const img=document.createElement("img");  
      img.src=content;  
      div.appendChild(img);  
    } else div.innerText=content;  
  
    // Add bubble click for action menu  
    div.addEventListener("click", (e)=>{  
      e.stopPropagation();  
      showBubbleMenu(div);  
    });  
  
    chatContainer.appendChild(div);  
    chatContainer.scrollTop=chatContainer.scrollHeight;  
  }  
  
  function showBubbleMenu(bubble){  
    // Remove existing menus  
    document.querySelectorAll(".bubble-menu").forEach(m=>m.remove());  
  
    const menu=document.createElement("div");  
    menu.className="bubble-menu";  
  
    // Copy icon  
    const copyBtn=document.createElement("i");  
    copyBtn.className="fa-regular fa-copy";  
    copyBtn.title="Copy";  
    copyBtn.onclick=(e)=>{  
      e.stopPropagation();  
      navigator.clipboard.writeText(bubble.innerText);  
      alert("‚úÖ Copied!");  
      menu.remove();  
    };  
    menu.appendChild(copyBtn);  
  
    // Delete icon  
    const delBtn=document.createElement("i");  
    delBtn.className="fa-solid fa-trash";  
    delBtn.title="Delete";  
    delBtn.onclick=(e)=>{  
      e.stopPropagation();  
      const q=bubble.dataset.user==="true"?bubble.innerText:null;  
      bubble.remove();  
      menu.remove();  
      // Also remove from memory  
      if(q!==null){  
        let history=JSON.parse(localStorage.getItem("celivox_memory"))||[];  
        history=history.filter(h=>h.q!==q);  
        localStorage.setItem("celivox_memory",JSON.stringify(history));  
      }  
    };  
    menu.appendChild(delBtn);  
  
    // Edit icon for user bubbles  
    if(bubble.dataset.user==="true"){  
      const editBtn=document.createElement("i");  
      editBtn.className="fa-solid fa-pen";  
      editBtn.title="Edit";  
      editBtn.onclick=(e)=>{  
        e.stopPropagation();  
        userInput.value=bubble.innerText;  
        bubble.remove();  
        menu.remove();  
        // Remove from memory  
        let history=JSON.parse(localStorage.getItem("celivox_memory"))||[];  
        history=history.filter(h=>h.q!==bubble.innerText);  
        localStorage.setItem("celivox_memory",JSON.stringify(history));  
      };  
      menu.appendChild(editBtn);  
    }  
  
    bubble.appendChild(menu);  
  }  
  
  // Remove menu if clicked outside  
  document.body.addEventListener("click", ()=>{  
    document.querySelectorAll(".bubble-menu").forEach(m=>m.remove());  
  });  
  
  // -------- Memory --------  
function saveConversation(q, a, isImage=false){  
  const userId = auth.currentUser.uid;  
    
  // if no active topic, create new one  
  if(!currentTopicId) {  
    const topicsRef = database.ref(`users/${userId}/topics`);  
    const newTopicRef = topicsRef.push();  
    currentTopicId = newTopicRef.key;  
    newTopicRef.set({  
      title: q.length > 20 ? q.slice(0, 20) + "..." : q,  
      messages: [],  
      lastUpdated: new Date().toISOString()  
    });  
  }  
  
  // save message under current topic  
  const chatRef = database.ref(`users/${userId}/topics/${currentTopicId}/messages`);  
  const newMsgRef = chatRef.push();  
  newMsgRef.set({ q, a, isImage, time: new Date().toISOString() });  
  
  // update topic info  
  database.ref(`users/${userId}/topics/${currentTopicId}`).update({  
    lastUpdated: new Date().toISOString()  
  });  
  
  loadChatHistory(); // refresh sidebar  
}  
function restoreConversation() {  
  chatContainer.innerHTML = "";  
  const user = auth.currentUser;  
  if (!user) return;  
  
  const userId = user.uid;  
  const topicsRef = database.ref(`users/${userId}/topics`);  
  
  topicsRef.orderByChild("lastUpdated").once("value", snapshot => {  
    if (!snapshot.exists()) return;  
  
    // Take the most recent topic as active  
    let latestTopicId = null;  
    snapshot.forEach(child => { latestTopicId = child.key; });  
    if (!latestTopicId) return;  
  
    loadTopicMessages(latestTopicId);  
    loadChatHistory(); // populate sidebar  
  });  
}  
  function clearMemory() {  
  const userId = auth.currentUser.uid;  
  database.ref('chats/' + userId).remove()  
    .then(() => {  
      localStorage.removeItem("celivox_memory"); // clear local storage too  
      alert("‚úÖ Memory cleared!");  
      chatContainer.innerHTML = "";  
    });  
}  
  function searchMemory(query){  
    const history=JSON.parse(localStorage.getItem("celivox_memory"))||[];  
    chatContainer.innerHTML="";  
    history.filter(h=>  
      h.q.toLowerCase().includes(query.toLowerCase())||  
      h.a.toLowerCase().includes(query.toLowerCase()))  
    .forEach(h=>{  
      appendBubble(h.q,true);  
      appendBubble(h.a,false,h.isImage);  
    });  
  }  
  
  // -------- Context & AI Calls --------  
  function buildContext(userInput){  
    const history=JSON.parse(localStorage.getItem("celivox_memory"))||[];  
    const recent=history.slice(-10).map(h=>`User: ${h.q}\nCelivox: ${h.a}`).join("\n");  
    return `${BASE_IDENTITY}\nConversation so far:\n${recent}\nUser: ${userInput}\nCelivox:`;  
  }  
  async function callGemini(prompt){try{const r=await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key="+GEMINI_API_KEY,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:prompt}]}]})});if(!r.ok)throw new Error("Gemini fail");const d=await r.json();return d?.candidates?.[0]?.content?.parts?.[0]?.text ?? null}catch{return null;}}  
  async function callOpenRouter(prompt){try{const r=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{"Authorization":`Bearer ${OPENROUTER_API_KEY}`,"Content-Type":"application/json"},body:JSON.stringify({model:"openai/gpt-3.5-turbo",messages:[{role:"user",content:prompt}]})});if(!r.ok)throw new Error("OpenRouter fail");const d=await r.json();return d?.choices?.[0]?.message?.content ?? null}catch{return null;}}  
    
  //get AI REPLY  
  async function getAIReply(text) {  
  const lower = text.toLowerCase();  
  
  // Custom responses  
  // Expanded triggers for image generation  
const imageTriggers = [  
  "generate image","draw","create image","make image","draw a",  
  "generate a picture","draw me","show me a picture","paint",  
  "illustrate","pic","img","image please"  
];  
  
if (imageTriggers.some(trigger => lower.includes(trigger))) {  
  return { type: "text", text: "üñºÔ∏è Image generation will be available in Celivox Premium soon!" };  
}  
  if (lower.includes("turn 18") || lower.includes("when will your developer turn 18")) {  
    return { type: "text", text: `Emmanuel Nwaije Ikemefuna will turn 18 on ${get18thBirthday()}.` };  
  }  
  
  // Only proceed to API if not handled by custom responses  
  const provider = "gemini";   
  try {  
    const contextPrompt = buildContext(text);   
    const response = await fetch("/.netlify/functions/api", {  
      method: "POST",  
      headers: { "Content-Type": "application/json" },  
      body: JSON.stringify({ message: contextPrompt, provider })  
    });  
  
    if (!response.ok) throw new Error("Network response not ok");  
  
    const data = await response.json();  
    return { type: "text", text: data.reply || "‚ùå I couldn‚Äôt get a response now." };  
  } catch (err) {  
    return { type: "text", text: "‚ùå Backend error: " + err.message };  
  }  
}  
  
  async function sendMessage(){  
  const text = userInput.value.trim();  
  if(!text) return;  
  
  appendBubble(text,true);  
  userInput.value = "";  
  userInput.disabled = true; // disable input while AI responds  
  appendBubble("ü§ñ Thinking...",false);  
  
  const reply = await getAIReply(text);  
  
  // Remove "Thinking..." bubble  
  chatContainer.removeChild(chatContainer.lastChild);  
  
  appendBubble(reply.text,false);  
  saveConversation(text,reply.text);  
  
  userInput.disabled = false; // re-enable input  
  userInput.focus();          // focus input  
}  
let currentTopicId = null; // no active chat on refresh  
function startNewTopic() {  
  currentTopicId = null;   // clear current chat  
  chatContainer.innerHTML = ""; // empty screen  
}  
function loadChatHistory() {
  const userId = auth.currentUser.uid;
  const topicsRef = database.ref(`users/${userId}/topics`);
  const container = document.getElementById("chatHistoryContainer");
  container.innerHTML = ""; // clear old list

  topicsRef.orderByChild("lastUpdated").once("value", snapshot => {
    const topics = [];
    snapshot.forEach(child => {
      topics.push({ id: child.key, data: child.val() });
    });

    // reverse so newest topic is first
    topics.reverse().forEach(topic => {
      const btn = document.createElement("button");
      btn.innerText = topic.data.title;
      btn.style.width = "100%";
      btn.style.margin = "5px 0";
      btn.style.padding = "6px";
      btn.style.textAlign = "left";
      btn.style.border = "none";
      btn.style.borderRadius = "6px";
      btn.style.cursor = "pointer";
      btn.style.background = "#e5e7eb";

      btn.onclick = () => loadTopicMessages(topic.id);
      container.appendChild(btn);
    });
  });
}
function loadTopicMessages(topicId) {
  const userId = auth.currentUser.uid;
  currentTopicId = topicId; // mark as active topic
  chatContainer.innerHTML = ""; // clear chat area

  const chatRef = database.ref(`users/${userId}/topics/${topicId}/messages`);
  chatRef.once("value", snapshot => {
    const messages = snapshot.val() || {};
    Object.keys(messages).forEach(msgId => {
      const msg = messages[msgId];
      appendBubble(msg.q, true);
      appendBubble(msg.a, false, msg.isImage);
    });
  });
}
</script> 
</body>  
  </html>
